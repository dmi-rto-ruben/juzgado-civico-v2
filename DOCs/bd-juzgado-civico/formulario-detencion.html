<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Detención</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-200">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-2xl font-bold mb-6">Registro de Detención</h1>

        <form action="" method="POST" class="bg-white rounded-lg shadow p-6">
            <!--@csrf-->
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Buscador de persona existente -->
                <div class="col-span-2">
                    <label class="block font-medium mb-2">Buscar persona registrada*</label>
                    <div x-data="personaSearch()" class="relative">
                        <input 
                            x-model="query"
                            @input.debounce.300ms="search"
                            @focus="showResults = true"
                            @click.away="showResults = false"
                            type="text" 
                            id="persona-search" 
                            class="w-full border rounded p-2"
                            placeholder="CURP, nombre o apodo"
                            autocomplete="off"
                            required
                        >
                        <input type="hidden" name="persona_id" x-model="selectedPerson?.id">
                        
                        <div style="display: none;" x-show="showResults && results.length > 0" class="absolute z-10 w-full mt-1 bg-white border rounded shadow-lg max-h-60 overflow-auto">
                            <template x-for="persona in results" :key="persona.id">
                                <div 
                                    @click="selectPerson(persona)"
                                    class="p-2 hover:bg-gray-100 cursor-pointer border-b"
                                    x-text="`${persona.nombre_completo} ${persona.identificadores.map(id => `[${id.tipo}: ${id.dato}]`).join(' ')}`"
                                ></div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Campos específicos de detención -->
                <div>
                    <label class="block font-medium mb-2">Hora de presentación*</label>
                    <input type="time" name="hora_presentacion" class="border rounded p-2 w-full" required>
                </div>
                
               
                <div>
                    <label class="block font-medium mb-2">Horas de arresto*</label>
                    <input type="number" name="horas_arresto" class="border rounded p-2 w-full" required>
                </div>
                <div>
                    <label class="block font-medium mb-2">Hora de salida</label>
                    <input type="time" name="hora_salida" class="border rounded p-2 w-full">
                </div>
                
                <div>
                    <label class="block font-medium mb-2">Edad</label>
                    <input type="number" name="edad" class="border rounded p-2 w-full">
                </div>
                
                <div class="col-span-2">
                    <label class="block font-medium mb-2">Artículos infringidos*</label>
                    <textarea name="articulos" rows="3" class="w-full border rounded p-2" required></textarea>
                </div>
                
                <div>
                    <label class="block font-medium mb-2">Costo en UMAS*</label>
                    <input type="number" step="10.00" name="costos_umas" class="border rounded p-2 w-full" required>
                </div>
            </div>
            
            <div class="mt-6">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                    Registrar Detención
                </button>
            </div>
        </form>
    </div>

    <script>
        function personaSearch() {
            return {
                query: '',
                results: [],
                selectedPerson: null,
                showResults: false,
                
                search() {
                    if (this.query.length < 2) {
                        this.results = [];
                        return;
                    }
                    
                    fetch(`/api/personas/buscar?q=${this.query}`)
                        .then(response => response.json())
                        .then(data => {
                            this.results = data;
                        });
                },
                
                selectPerson(persona) {
                    this.selectedPerson = persona;
                    this.query = persona.nombre_completo;
                    this.showResults = false;
                }
            }
        }
    </script>
</body>
</html>